<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wedding Frame</title>

    <link rel="stylesheet" href="index.css" />

    <script defer src="/__/firebase/10.7.1/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/10.7.1/firebase-storage-compat.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=false"></script>
  </head>
  <body>
    <form onsubmit="writeToStorage(event)">
      <input type="file" name="imageUpload" multiple accept="image/*,video/*" />

      <button type="submit">Upload</button>
    </form>

    <script>
      async function writeToStorage(e) {
        e.preventDefault();

        try {
          const formData = new FormData(e.target);
          const filesToUpload = formData.getAll("imageUpload");

          const promises = [];

          for (const file of filesToUpload) {
            const storageRef = firebase.storage().ref();
            const fileRef = storageRef.child("Jelena2024/" + file.name);
            promises.push(fileRef.put(file));
          }

          await Promise.all(promises);

          alert(`Successfully uploaded ${promises.length} images!`);
        } catch (error) {
          console.error(error);
          alert("Failed to upload images!");
        }
      }
    </script>
  </body>
</html>
